#!/bin/sh
/app/wait-for-it.sh -c 'nc -z zap 8090' -t 60
/app/wait-for-it.sh -c 'nc -z webgoat 8080' -t 60

python3 ./pen-test-app.py --zap-host zap:8090 --target http://webgoat:8080/WebGoat/

# create directories to store results in
mkdir -p /results/zap/html
mkdir -p /results/zap/json

# sleep for 10 seconds & then get results form ZAP
sleep 10
curl -X GET http://zap:8090/HTML/core/view/alerts > /results/zap/html/results.HTML
curl -X GET http://zap:8090/JSON/core/view/alerts > /results/zap/json/results.JSON

# tests complete: terminate ZAP & webgoat
curl -X GET http://zap:8090/JSON/core/action/shutdown/
docker kill  wasttesting_webgoat_1 --signal=SIGINT
